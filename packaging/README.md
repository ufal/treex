# How to release Treex to CPAN

* go to the directory, e.g. for Treex-Core `cd Treex-Core`
* `make clean` after previous attempts
* `git status` to check everything is commited (and pushed to master)
* `editor Changes.template` and substitute "TODO describe changes" with a description of the release
* `make build` and check the resulting tar.gz (e.g Treex-Core-2.20160630.tar.gz) if it contains only the files you want
 - you can run `make prebuild` first and inspect/edit e.g. the file `Changes` before it is packaged
* You should run `make test`, but note that this runs also perlcritic and pod-coverage which usually generate many fails.
If you check none of these fails is important (revealing some bug), you can comment out the `[@TestingMania]` section in `dist.ini`, so `dzil release` in the next step works ok.
* Upload the tar.gz to https://pause.perl.org either manually, or
 - see [tutorial](http://dzil.org/tutorial/release.html), create the `~/.pause` file, consider `chmod go-r ~/.pause`
 - run `dzil release`
* `Changes.template` should now contain your description plus a TODO placeholder for the next release.
Commit it with `git add Changes.template; git commit; git push`

## TODO
* PAUSE fails to index Treex::Core::ScenarioParser at CPAN because
 - Treex-Core-2.20151210.tar.gz has a higher version number (2.20151210) than the curren version: 1.967013 because
 - PkgVersion dzil refuses to add the new version number to ScenarioParser.pm and says "skipping lib/Treex/Core/ScenarioParser.pm: assigns to $VERSION" because
 - ScenarioParser.pm (autogenerated by compile_grammar.pl) contains line (1760) `our $VERSION = '1.967009';`
 - I think this is not a fatal problem, the rest of Treex-Core is indexed OK.
 - SolutionA: use the `package\n  Treex::Core::ScenarioParser;` trick, so the module is ignored by PAUSE/CPAN
 - SolutionB: remove the `our $VERSION = '1.967009';` line
* `Git::Tag` and `Git::Commit` dzil plugins do not work now. Maybe because `dzil release` fails because of the PAUSE indexing problem above. 
* I am not sure if changing `Changes.template` but not commiting the chages does not make problems with the `Git::Check` dzil plugin. There is an option `allow_dirty`.
* Fix the bugs found by perlcritic and pod-coverage or silence them, so `make test` does not fail.
